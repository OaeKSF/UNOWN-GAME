<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Cazador Rápido RITMICO FINAL</title>
    <style>
              /* CSS para el diseño */
        body {
            /* 3 VIDAS: NEGRO (ajustado con JS en iniciarJuego) */
            background-color: #000; 
            color: #fff;
            margin: 0;
            overflow: hidden;
            font-family: 'Courier New', monospace; 
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            /* Transición para el cambio de color del fondo */
            transition: background-color 1.5s ease;
        }

        /* PANTALLA DE INICIO */
        #pantalla-inicio {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            background-color: #000;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }

        /* BOTÓN PERSONALIZADO (URL de Botón Reemplazada) */
        #boton-inicio {
            background-image: url('https://drive.google.com/uc?export=download&id=1CSecBkyVLJwfLZW_GccbQZBzUCowKsn0'); 
            background-size: contain; 
            background-position: center;
            background-color: transparent; 
            background-repeat: no-repeat;
            width: 150px; 
            height: 150px;
            border: none;
            cursor: pointer;
            padding: 0;
            font-size: 0; 
            line-height: 0;
            outline: none;
        }

        /* CONTENEDOR PRINCIPAL */
        #contenedor-juego {
            position: relative;
            width: 100vw;
            height: 100vh;
            opacity: 0; 
            pointer-events: none; 
            transition: opacity 0.5s; 
        }

        /* ESTILO BASE PARA TODOS LOS UNOWNS CREADOS DINÁMICAMENTE */
        .unown { 
            width: 50px; 
            height: 50px;
            background-size: cover; 
            background-color: transparent; 
            border-radius: 0; 
            position: absolute;
            transition: opacity 0.1s; 
            touch-action: manipulation;
            z-index: 5; 
        }

        /* Contadores (Puntos y Vidas) */
        #contador, #vidas-contador {
            position: absolute;
            font-size: 1.5em;
            background: rgba(255, 255, 255, 0.1);
            padding: 5px 10px;
            border-radius: 5px;
            z-index: 10;
        }
        #contador { top: 20px; left: 20px; }
        #vidas-contador { top: 20px; right: 20px; }

        #letra-secreta {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 6em; 
            color: #FF0000; 
            text-shadow: 0 0 15px #FF0000;
            transition: none; 
            opacity: 1; 
            pointer-events: none;
            white-space: pre; 
            z-index: 1; 
        }

        /* JUMPSCARE */
        #jumpscare-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            background-color: black; 
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 999;
        }
        #jumpscare-img {
            max-width: 100%;
            max-height: 100%;
            display: block;
            filter: brightness(80%); 
        }
        #mensaje-reinicio {
            position: absolute;
            bottom: 5%; 
            color: #fff;
            font-size: 1.2em;
            opacity: 0.5; 
            text-align: center;
        }
      
    </style>
</head>
<body>

    <audio id="musica-juego" loop>
        <source src="https://drive.google.com/uc?export=download&id=1Gy0u9gqsWWxXvHJJnUZZVY3BFSKEQhZt" type="audio/mpeg"> 
        <source src="https://drive.google.com/uc?export=download&id=18PQD-lXIokD94CMg_MBqTbYmcYmkuoBk" type="audio/ogg">
    </audio>
    <audio id="audio-jumpscare">
        <source src="https://drive.google.com/uc?export=download&id=1OyptBkSQliViVi7DoXU67krtLF7dKEhaC_" type="audio/mpeg">
    </audio> 
    <audio id="audio-pierde-vida">
        <source src="https://drive.google.com/uc?export=download&id=1J73lS570sSKV5dYbx8CSC9VM4vzlJ_fn" type="audio/mpeg">
    </audio>

    <div id="pantalla-inicio">
        <button id="boton-inicio"></button>
    </div>

    <div id="jumpscare-overlay">
        <img id="jumpscare-img" src="https://drive.google.com/uc?export=download&id=1uzgVc2nfAeUnae-kYDka5xbAf4Ft-8BJ" alt="Jumpscare de Gold">
        <div id="mensaje-reinicio">Espera para volver a intentar</div>
    </div>

    <div id="contenedor-juego">
        <div id="contador">Puntos: 0</div>
        <div id="vidas-contador">Vidas: 3</div> 
        <div id="letra-secreta"></div>
        </div>

    <script>
    const MAX_VIDAS = 3;
    const MAX_UNOWNS = 5; 
    const PROBABILIDAD_FANTASMA = 0.15; 
    const TIEMPO_BASE_MAX = 1500; 
    const TIEMPO_BASE_MINIMO = 500; 
    const PENALIZACION_POR_TIEMPO = 100; 
    const FRECUENCIA_NERF_TIEMPO = 30; // Penalización de tiempo cada 30 puntos
    
    // VALORES PARA LA OPACIDAD
    const OPACIDAD_MAX = 1.0; 
    const OPACIDAD_MIN = 0.40; 
    const REDUCCION_OPACIDAD = 0.05; 
    
    let puntosRequisitoVida = 5; 
    let penalizadorTiempo = 0; 
    let reduccionOpacidad = 0; 

    const bodyElement = document.body; 
    const contenedorJuego = document.getElementById('contenedor-juego');
    const pantallaInicio = document.getElementById('pantalla-inicio');
    const botonInicio = document.getElementById('boton-inicio');

    const contadorElement = document.getElementById('contador');
    const vidasElement = document.getElementById('vidas-contador');
    const letraElement = document.getElementById('letra-secreta');
    const jumpscareOverlay = document.getElementById('jumpscare-overlay'); 
    
    const musicaFondo = document.getElementById('musica-juego'); 
    const jumpscareAudio = document.getElementById('audio-jumpscare'); 
    const pierdeVidaAudio = document.getElementById('audio-pierde-vida'); 
    
    pierdeVidaAudio.volume = 0.5;

    let puntos = 0;
    let vidas = MAX_VIDAS; 
    let gameIsOver = false;
    let intervaloRitmo;
    let numUnowns = 1; 
    
    let timeoutsUnowns = []; 
    let unownsActivos = 0; 
    let unownsNormalesRestantes = 0; 
    
    const frases = ["IM DEAD", "NO MORE", "CELEBI DIED", "TYPHLOSION", "LOST SILVER", "GOLD"];
    let fraseActual = frases[0];
    let indiceFrase = 0;
    let indiceLetra = 0;

    // --- Funciones de Utilidad ---
    
    function actualizarColorFondo() {
        let color;
        if (vidas === 3) {
            color = '#000000'; 
        } else if (vidas === 2) {
            color = '#330000'; 
        } else if (vidas === 1) {
            color = '#800000'; 
        } else {
            color = '#000000'; 
        }
        bodyElement.style.backgroundColor = color;
    }

    // --- FUNCIÓN DE INICIO PRINCIPAL ---
    function iniciarJuego() {
        pantallaInicio.style.display = 'none';
        contenedorJuego.style.opacity = 1;
        contenedorJuego.style.pointerEvents = 'auto';
        musicaFondo.play().catch(e => console.error("Error al iniciar música:", e));

        contenedorJuego.addEventListener('click', manejarClicFallido);
        
        actualizarColorFondo();
        intervaloRitmo = setInterval(mostrarLetraFraseRitmica, 500); 
        iniciarSiguienteRonda();
    }

    botonInicio.addEventListener('click', iniciarJuego);
    
    function manejarClicFallido(event) {
        if (event.target.classList && !event.target.classList.contains('unown') && !gameIsOver) {
            falloGeneral(); 
        }
    }

    // --- FUNCIÓN CENTRAL: CREA Y MUEVE UN UNOWN ---

    function crearYMoverUnown(index) {
        // 1. Crear el elemento Unown
        const unown = document.createElement('div');
        unown.classList.add('unown');
        unown.id = `unown-${index}`;
        contenedorJuego.appendChild(unown);
        unownsActivos++; 

        // 2. Establecer posición, tipo y opacidad
        const circleSize = 50; 
        const safeZoneX = 150; 
        const safeZoneY = 80;  
        const maxX = Math.max(0, window.innerWidth - circleSize);
        const maxY = Math.max(0, window.innerHeight - circleSize);
        const minX = safeZoneX; 
        const minY = safeZoneY; 

        const x = Math.floor(Math.random() * (maxX - minX)) + minX;
        const y = Math.floor(Math.random() * (maxY - minY)) + minY;
        
        const esFantasma = Math.random() < PROBABILIDAD_FANTASMA; 
        unown.dataset.isGhost = esFantasma; 
        
        // URLS de Unown (Normal y Fantasma) INCORPORADAS
        unown.style.backgroundImage = esFantasma 
            ? "url('https://drive.google.com/uc?export=download&id=1R4qlooneDKf3oxWTB8VE4AdwLdPaxa4Q')" 
            : "url('https://drive.google.com/uc?export=download&id=13O7B1zgpN9th8UD2ILqalMMJ55sXXqxT')";
            
        unown.style.left = `${x}px`;
        unown.style.top = `${y}px`;
        
        // Opacidad basada en puntos
        const opacidadActual = Math.max(OPACIDAD_MIN, OPACIDAD_MAX - reduccionOpacidad);
        unown.style.opacity = opacidadActual; 
        
        if (!esFantasma) {
            unownsNormalesRestantes++;
        }

        // 3. Lógica de Tiempo y Penalización
        
        const tiempoBaseAjustado = Math.max(TIEMPO_BASE_MINIMO, TIEMPO_BASE_MAX - penalizadorTiempo);
        const tiempoBase = Math.random() * (tiempoBaseAjustado - 1000) + 1000; 

        const unownsNormalesEnRonda = contenedorJuego.querySelectorAll('.unown:not([data-is-ghost="true"])').length;
        const tiempoExtra = Math.max(0, unownsNormalesEnRonda - 1) * 500;
        
        const tiempoEspera = tiempoBase + tiempoExtra;


        // Detección de Fallo (se activa si no fue clickeado)
        const timeoutID = setTimeout(() => {
            if (!unown.dataset.clicked) {
                if (!esFantasma) {
                    falloRondaEspecifico(unown); 
                } else {
                    unownsActivos--; 
                    limpiarUnown(unown);
                    verificarRondaCompleta(); 
                }
            }
        }, tiempoEspera);

        timeoutsUnowns.push(timeoutID);

        // 4. Listener de Clic
        unown.addEventListener('click', function(event) {
            if (gameIsOver || unown.dataset.clicked) return;

            clearTimeout(timeoutID); 
            unown.dataset.clicked = true;
            unownsActivos--; 
            
            if (esFantasma) {
                if (vidas < MAX_VIDAS) {
                    vidas++;
                    vidasElement.textContent = `Vidas: ${vidas}`;
                }
            } else {
                puntos++;
                contadorElement.textContent = `Puntos: ${puntos}`;
                unownsNormalesRestantes--; 
                
                // REGLA: Puntos de vida extra
                if (puntos > puntosRequisitoVida && vidas < MAX_VIDAS) {
                    vidas++;
                    vidasElement.textContent = `Vidas: ${vidas}`;
                    puntosRequisitoVida += 5; 
                }
            }
            
            limpiarUnown(unown);
            actualizarColorFondo();
            verificarRondaCompleta();
        });
    }
    
    function limpiarUnown(unownElement) {
        if (unownElement && unownElement.parentElement) {
            unownElement.parentElement.removeChild(unownElement);
        }
    }

    function verificarRondaCompleta() {
        if (unownsNormalesRestantes === 0) {
            
            // Lógica de Penalización de Tiempo (cada 30 puntos)
            if (puntos > 0 && puntos % FRECUENCIA_NERF_TIEMPO === 0) {
                 penalizadorTiempo = Math.min(
                     TIEMPO_BASE_MAX - TIEMPO_BASE_MINIMO, 
                     penalizadorTiempo + PENALIZACION_POR_TIEMPO
                 );
            }
            
            // Lógica de Reducción de Opacidad (cada 10 puntos)
            if (puntos > 0 && puntos % 10 === 0) {
                reduccionOpacidad = Math.min(
                    OPACIDAD_MAX - OPACIDAD_MIN, 
                    reduccionOpacidad + REDUCCION_OPACIDAD
                );
            }
            
            // Eliminar todos los fantasmas restantes
            contenedorJuego.querySelectorAll('.unown').forEach(u => {
                const timeoutId = timeoutsUnowns.find(id => id === u.timeoutID);
                if (timeoutId) clearTimeout(timeoutId);
                u.remove();
            });
            unownsActivos = 0; 
            setTimeout(iniciarSiguienteRonda, 100); 
        }
    }

    function iniciarSiguienteRonda() {
        if (gameIsOver) return;
        
        timeoutsUnowns.forEach(clearTimeout);
        timeoutsUnowns = [];
        
        unownsActivos = 0;
        unownsNormalesRestantes = 0; 

        // Determinar el número actual de Unowns Normales (incrementa cada 10 puntos)
        if (puntos > 0 && puntos % 10 === 0 && numUnowns < MAX_UNOWNS) {
            numUnowns++;
        }
        
        // Generar todos los Unowns
        for (let i = 0; i < numUnowns; i++) {
            setTimeout(() => crearYMoverUnown(i), i * 50); 
        }
    }
    
    // --- FUNCIÓN DE FALLO DE RONDA (LÓGICA DE VIDAS) ---
    
    function falloRondaEspecifico(unownElement) {
        if (unownElement) {
             unownElement.remove();
             unownsActivos--;
        }
        falloGeneral();
    }
    
    function falloGeneral() {
        if (gameIsOver) return;

        timeoutsUnowns.forEach(clearTimeout);
        timeoutsUnowns = [];
        contenedorJuego.querySelectorAll('.unown').forEach(u => u.remove());
        unownsActivos = 0; 
        unownsNormalesRestantes = 0;

        vidas--;
        vidasElement.textContent = `Vidas: ${vidas}`;
        actualizarColorFondo(); 

        if (vidas <= 0) {
            gameOverJumpscare(); 
        } else {
            if (puntos > 0) {
                puntos = Math.max(0, puntos - 1);
                contadorElement.textContent = `Puntos: ${puntos}`;
            }
            
            pierdeVidaAudio.currentTime = 0;
            pierdeVidaAudio.play().catch(e => console.error("Error al reproducir perish.mp3:", e));
            
            setTimeout(iniciarSiguienteRonda, 500);
        }
    }


    // --- FUNCIONES DE JUMPSCARE Y RITMO ---

    function gameOverJumpscare() {
        gameIsOver = true;
        musicaFondo.pause();
        musicaFondo.currentTime = 0; 
        jumpscareOverlay.style.display = 'flex';
        
        jumpscareAudio.loop = false;
        jumpscareAudio.currentTime = 0;
        jumpscareAudio.play(); 
        
        clearInterval(intervaloRitmo);
        
        // Espera a que termine el audio del jumpscare para recargar
        jumpscareAudio.onended = function() {
            location.reload(); 
        };
    }

    function mostrarLetraFraseRitmica() {
        if (gameIsOver) return;
        
        while (indiceLetra < fraseActual.length && fraseActual[indiceLetra] === ' ') {
            indiceLetra++; 
        }

        if (indiceLetra < fraseActual.length) {
            letraElement.textContent = fraseActual[indiceLetra];
            indiceLetra++;

        } else {
            indiceLetra = 0;
            indiceFrase = (indiceFrase + 1) % frases.length;
            fraseActual = frases[indiceFrase];
            mostrarLetraFraseRitmica();
        }
                             }
                             
    </script>

</body>
</html>
